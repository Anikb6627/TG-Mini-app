<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Auto Roulette Demo</title>
<style>
  body { background:#061021; color:#eee; font-family:Arial, sans-serif; margin:0; padding:20px; }
  .wheel-container { text-align:center; margin-bottom:20px; }
  canvas { border-radius:50%; }
  .pointer { width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent;
             border-bottom:30px solid #fff; margin:0 auto; position:relative; top:-10px; }
  .controls { margin-top:10px; text-align:center; }
  button { margin:5px; padding:8px 12px; border:0; border-radius:6px; background:#f59e0b; color:#000; cursor:pointer; }
  .board { display:grid; grid-template-columns:repeat(12,1fr); gap:4px; margin-top:20px; }
  .num { padding:6px; text-align:center; border-radius:4px; cursor:pointer; }
  .num.red { background:#e83e3e; }
  .num.black { background:#111; }
  .num.green { background:#2ecc71; }
  #placed { margin-top:10px; min-height:20px; }
  #history { margin-top:10px; display:flex; gap:6px; flex-wrap:wrap; }
  .h { width:28px; height:28px; border-radius:50%; display:flex; justify-content:center; align-items:center; font-size:12px; }
</style>
</head>
<body>
  <h2>Auto Roulette (Demo)</h2>
  <div class="wheel-container">
    <div class="pointer"></div>
    <canvas id="wheel" width="400" height="400"></canvas>
  </div>
  <div class="controls">
    Balance: <span id="balance"></span> credits
    <br>
    <input type="number" id="betAmount" value="10" min="1">
    <button id="depositBtn">Deposit</button>
    <button id="withdrawBtn">Withdraw</button>
    <div>Next spin in <span id="countdown">15</span>s</div>
  </div>
  <div class="board" id="board"></div>
  <div id="placed"></div>
  <div>Last result: <span id="lastResult">â€”</span></div>
  <div id="history"></div>

<script>
const wheel = document.getElementById('wheel');
const ctx = wheel.getContext('2d');
const SEGS = 37;
const REDS = new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
const GREENS = new Set([0]);
let anglePer = 2*Math.PI/SEGS;
let rotation = 0;

let balance = Number(localStorage.getItem('roulette_balance')||1000);
let bets = [];
let countdown = 15;
let spinning = false;
let history = [];

function drawWheel(rot=0){
  let cx=200, cy=200, r=190;
  ctx.clearRect(0,0,400,400);
  for(let i=0;i<SEGS;i++){
    let start=rot + i*anglePer;
    let end=start+anglePer;
    let color= GREENS.has(i)?'#2ecc71': (REDS.has(i)?'#e83e3e':'#111');
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.arc(cx,cy,r,start,end);
    ctx.fillStyle=color;
    ctx.fill();
    ctx.stroke();
    ctx.save();
    ctx.translate(cx,cy);
    ctx.rotate(start+anglePer/2);
    ctx.fillStyle='#fff';
    ctx.textAlign='right';
    ctx.fillText(i,r-10,5);
    ctx.restore();
  }
}

function updateBalance(){ 
  localStorage.setItem('roulette_balance',balance); 
  document.getElementById('balance').textContent=balance; 
}

function spin(){
  if(spinning) return;
  spinning=true;
  let result = Math.floor(Math.random()*SEGS);
  let targetAngle = 2*Math.PI*(result/SEGS);
  rotation = rotation + (10*Math.PI) + targetAngle; // spin + land
  let duration = 5000;
  let start=null;
  function animate(ts){
    if(!start) start=ts;
    let p=(ts-start)/duration;
    if(p>1)p=1;
    let current = rotation*p;
    drawWheel(current);
    if(p<1) requestAnimationFrame(animate);
    else {
      spinning=false;
      settle(result);
    }
  }
  requestAnimationFrame(animate);
}

function settle(result){
  document.getElementById('lastResult').textContent=result;
  history.unshift(result);
  if(history.length>12)history.pop();
  let hEl=document.getElementById('history');hEl.innerHTML='';
  history.forEach(n=>{
    let d=document.createElement('div');
    d.className='h';
    d.style.background= GREENS.has(n)?'#2ecc71': (REDS.has(n)?'#e83e3e':'#111');
    d.textContent=n; hEl.appendChild(d);
  });
  // payout
  bets.forEach(b=>{
    if(b.num===result){
      balance+=b.amount*36;
    }
  });
  bets=[];
  document.getElementById('placed').textContent='';
  updateBalance();
}

function makeBoard(){
  let b=document.getElementById('board');
  for(let i=0;i<SEGS;i++){
    let d=document.createElement('div');
    d.className='num';
    if(GREENS.has(i)) d.classList.add('green');
    else if(REDS.has(i)) d.classList.add('red');
    else d.classList.add('black');
    d.textContent=i;
    d.onclick=()=>{
      let amt=Number(document.getElementById('betAmount').value);
      if(amt>0 && balance>=amt){
        balance-=amt;
        bets.push({num:i,amount:amt});
        document.getElementById('placed').textContent+=`Bet ${amt} on ${i}. `;
        updateBalance();
      }
    }
    b.appendChild(d);
  }
}

function loopCountdown(){
  countdown--;
  if(countdown<=0){
    countdown=15;
    spin();
  }
  document.getElementById('countdown').textContent=countdown;
}
setInterval(loopCountdown,1000);

document.getElementById('depositBtn').onclick=()=>{
  let amt=Number(prompt('Deposit amount','1000'));
  if(amt>0){ balance+=amt; updateBalance(); }
}
document.getElementById('withdrawBtn').onclick=()=>{
  let amt=Number(prompt('Withdraw amount','100'));
  if(amt>0 && amt<=balance){ balance-=amt; updateBalance(); }
}

makeBoard();
updateBalance();
drawWheel();
</script>
</body>
</html>
