<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crash Game ‚Äî Demo (No real money)</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#06b6d4;--muted:#94a3b8;--danger:#ef4444}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#071027 0%, #071a2a 100%); color:#e6eef6; margin:0; padding:24px; box-sizing:border-box}
    .app{max-width:980px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:16px; box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px 0;font-size:20px}
    .panel{display:flex;flex-direction:column;gap:12px}
    .controls{display:flex;gap:8px;align-items:center}
    input[type="number"], input[type="text"], select{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit}
    button{background:var(--accent);border:none;padding:10px 12px;border-radius:10px;color:#022;cursor:pointer;font-weight:600}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .big{font-size:36px;font-weight:700;letter-spacing:1px}
    .mult{display:flex;align-items:flex-end;gap:12px}
    .mult .big{color:var(--accent)}
    .history{max-height:300px;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:6px}
    .row{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px;border-radius:8px;background:rgba(0,0,0,0.2)}
    .meter{height:8px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden}
    .meter > i{display:block;height:100%;width:0%;background:linear-gradient(90deg, rgba(6,182,212,1), rgba(56,189,248,0.9))}
    .note{color:var(--muted);font-size:13px}
    .danger{color:var(--danger);font-weight:700}
    footer{margin-top:14px;color:var(--muted);font-size:13px}
    @media (max-width:900px){.app{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app">
    <div class="card panel">
      <h1>Crash Game ‚Äî Demo</h1>
      <div class="note">‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶Æ‡ßÇ‡¶≤‡¶ï ‡¶°‡ßá‡¶Æ‡ßã ‚Äî ‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡ßá‡¶á‡•§</div>

      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="note">Balance</div>
          <div class="big" id="balanceDisplay">1000.00</div>
        </div>
        <div style="text-align:right">
          <div class="note">Round</div>
          <div id="roundDisplay">‚Äî</div>
        </div>
      </div>

      <div class="card" style="padding:12px">
        <div class="controls">
          <label class="note">Bet</label>
          <input id="betInput" type="number" min="1" step="1" value="10" style="width:100px" />
          <label class="note">Auto cashout (x)</label>
          <input id="autoInput" type="number" min="1" step="0.1" value="2" style="width:90px" />
          <button id="startBtn">Start Round</button>
          <button id="cashoutBtn" class="secondary" disabled>Cashout</button>
        </div>
        <div class="note">Auto-play:
          <select id="autoplaySelect" style="width:140px">
            <option value="off">Off</option>
            <option value="10">10 rounds</option>
            <option value="50">50 rounds</option>
            <option value="manual">Manual until stop</option>
          </select>
          <button id="stopAuto" class="secondary" style="margin-left:6px" disabled>Stop</button>
        </div>
      </div>

      <div class="card" style="padding:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="note">Multiplier</div>
            <div class="mult">
              <div class="big" id="multDisplay">1.00x</div>
              <div class="note" id="statusNote">Waiting</div>
            </div>
          </div>
          <div style="width:240px">
            <div class="note">Progress</div>
            <div class="meter"><i id="meterBar"></i></div>
          </div>
        </div>
      </div>

      <div class="card" style="padding:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="note">Last Result</div>
            <div id="lastResult">‚Äî</div>
            <div class="note">Wins / Losses</div>
            <div id="wl">0 / 0</div>
          </div>
          <div style="text-align:right">
            <div class="note">Total Bets</div>
            <div id="totalBets">0</div>
            <div class="note">Profit</div>
            <div id="profit">0.00</div>
          </div>
        </div>
      </div>

      <footer>
        Demo logic only. Oversimplified RNG for teaching. Don't use for gambling.
      </footer>
    </div>

    <div class="card" style="padding:12px">
      <h1>History</h1>
      <div class="history" id="historyList"></div>
    </div>
  </div>

<script>
/*
  Educational Crash Game (front-end only)
  - No real money / no server. All RNG client-side for demo.
  - Features: start round, manual cashout, auto-cashout, autoplay, history.
*/

const balanceEl = document.getElementById('balanceDisplay');
const betInput = document.getElementById('betInput');
const autoInput = document.getElementById('autoInput');
const startBtn = document.getElementById('startBtn');
const cashoutBtn = document.getElementById('cashoutBtn');
const multDisplay = document.getElementById('multDisplay');
const statusNote = document.getElementById('statusNote');
const meterBar = document.getElementById('meterBar');
const historyList = document.getElementById('historyList');
const roundDisplay = document.getElementById('roundDisplay');
const lastResult = document.getElementById('lastResult');
const wl = document.getElementById('wl');
const totalBetsEl = document.getElementById('totalBets');
const profitEl = document.getElementById('profit');
const autoplaySelect = document.getElementById('autoplaySelect');
const stopAutoBtn = document.getElementById('stopAuto');

let balance = 1000.0;
let round = 0;
let running = false;
let currentMultiplier = 1.0;
let crashPoint = null;
let stepInterval = null;
let betsTotal = 0;
let wins = 0, losses = 0;
let profit = 0;
let autoplayMode = false;
let autoplayRemaining = 0;

function fmt(n){ return Number(n).toFixed(2); }
function setBalance(v){ balance = v; balanceEl.textContent = fmt(balance); }

setBalance(balance);

// RNG for crash point ‚Äî biased so small multipliers more likely.
// This is a simple demo distribution using inverse-exponential transform.
function generateCrashPoint() {
  // choose base randomness
  const r = Math.random(); // 0..1
  // tweak to get reasonable distribution: min 1.0, long tail
  const min = 1.0;
  const max = 100; // clamp max for UI sanity
  // transform: heavy tail
  let x = Math.max(min, Math.floor((1 / (1 - r)) * 100) / 100);
  if (x > max) x = max;
  // introduce occasional very small crashes
  if (Math.random() < 0.05) x = 1 + Math.random() * 0.5;
  return x;
}

function startRound() {
  if (running) return;
  const bet = Number(betInput.value);
  if (!bet || bet <= 0) { alert('‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡ßá‡¶ü ‡¶¨‡¶∏‡¶æ‡¶ì'); return; }
  if (bet > balance) { alert('Balance ‡¶è ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡ßá‡¶á'); return; }

  // initialize
  running = true;
  currentMultiplier = 1.0;
  multDisplay.textContent = currentMultiplier.toFixed(2) + 'x';
  meterBar.style.width = '0%';
  statusNote.textContent = 'Running‚Ä¶';
  round++;
  roundDisplay.textContent = round;
  crashPoint = generateCrashPoint();
  // deduct bet immediately (typical behavior)
  balance -= bet;
  setBalance(balance);
  betsTotal++;
  totalBetsEl.textContent = betsTotal;

  // enable cashout button
  cashoutBtn.disabled = false;
  startBtn.disabled = true;

  // animation speed and step size can be tuned
  let speed = 60; // ms per step
  let accel = 1.01; // multiplier growth factor per step (slower -> closer to real feel)
  const autoCashout = Number(autoInput.value) || null;

  stepInterval = setInterval(() => {
    // grow multiplier multiplicatively for smoother curve
    currentMultiplier = currentMultiplier * accel;
    // small linear bump for feel
    currentMultiplier += 0.01;

    // update UI
    multDisplay.textContent = currentMultiplier.toFixed(2) + 'x';
    // map multiplier to progress bar (log scale for nicer UI)
    const progress = Math.min(100, Math.log(currentMultiplier + 1) / Math.log(100 + 1) * 100);
    meterBar.style.width = progress + '%';

    // auto-cashout check
    if (autoCashout && currentMultiplier >= autoCashout) {
      doCashout(bet, autoCashout, true);
      return;
    }

    // crash check: if currentMultiplier >= crashPoint -> crash
    if (currentMultiplier >= crashPoint) {
      // crashed ‚Äî player loses bet (already deducted)
      clearInterval(stepInterval);
      running = false;
      startBtn.disabled = false;
      cashoutBtn.disabled = true;
      statusNote.textContent = 'Crashed üòµ';
      lastResult.textContent = `Crashed @ ${crashPoint.toFixed(2)}x ‚Äî Lost ${fmt(bet)}`;
      losses++;
      wl.textContent = wins + ' / ' + losses;
      historyAdd({round, bet, result: 0, crash: crashPoint});
      profit = profit - bet;
      profitEl.textContent = fmt(profit);
      stopAutoIfNeeded();
    }

    // slightly increase accel over time to simulate speed-up
    accel *= 1.0008;
  }, speed);
}

function doCashout(bet, atMultiplier=null, isAuto=false) {
  if (!running) return;
  // calculate winnings
  const m = (atMultiplier !== null) ? atMultiplier : currentMultiplier;
  const winnings = bet * m;
  clearInterval(stepInterval);
  running = false;
  startBtn.disabled = false;
  cashoutBtn.disabled = true;
  // credit winnings to balance (bet was deducted earlier)
  balance += winnings;
  setBalance(balance);
  statusNote.textContent = 'Cashed out ‚úÖ';
  lastResult.textContent = `Cashed out @ ${m.toFixed(2)}x ‚Äî Won ${fmt(winnings)}`;
  wins++;
  wl.textContent = wins + ' / ' + losses;
  historyAdd({round, bet, result: winnings, cashedAt: m, auto: isAuto});
  profit = profit + (winnings - bet);
  profitEl.textContent = fmt(profit);
  stopAutoIfNeeded();
}

function historyAdd(obj) {
  const el = document.createElement('div');
  el.className = 'row';
  if (obj.result > 0) {
    el.innerHTML = `<div>Round ${obj.round} ‚Äî Bet ${fmt(obj.bet)} ‚Äî <strong>Win ${fmt(obj.result)}</strong></div><div>${obj.cashedAt ? fmt(obj.cashedAt)+'x' : ''}</div>`;
  } else {
    el.innerHTML = `<div>Round ${obj.round} ‚Äî Bet ${fmt(obj.bet)} ‚Äî <span class="danger">Crashed</span></div><div>${fmt(obj.crash)}x</div>`;
  }
  historyList.prepend(el);
}

// event bindings
startBtn.addEventListener('click', () => {
  startRound();
});

cashoutBtn.addEventListener('click', () => {
  const bet = Number(betInput.value) || 0;
  // manual cashout at current multiplier
  doCashout(bet, currentMultiplier, false);
});

autoplaySelect.addEventListener('change', () => {
  const v = autoplaySelect.value;
  if (v === 'off') { autoplayMode = false; stopAutoBtn.disabled = true; return; }
  autoplayMode = true;
  stopAutoBtn.disabled = false;
  if (v === 'manual') {
    autoplayRemaining = Infinity;
  } else {
    autoplayRemaining = Number(v);
  }
  // start autoplay loop if not running
  if (!running) autoplayLoop();
});

stopAutoBtn.addEventListener('click', () => {
  autoplayMode = false;
  autoplayRemaining = 0;
  stopAutoBtn.disabled = true;
  autoplaySelect.value = 'off';
});

// autoplayer: starts round, waits end, optionally cashes out if autoInput set
async function autoplayLoop() {
  if (!autoplayMode || autoplayRemaining === 0 || balance <= 0) return;
  // start new round
  startRound();
  // wait until running becomes false (round ended)
  await new Promise(resolve => {
    const check = setInterval(() => {
      if (!running) { clearInterval(check); resolve(); }
    }, 50);
  });
  // decrement counter if finite
  if (isFinite(autoplayRemaining)) autoplayRemaining--;
  // small delay between rounds
  setTimeout(() => {
    if (autoplayMode && autoplayRemaining !== 0 && balance > 0) {
      autoplayLoop();
    } else {
      autoplayMode = false;
      autoplaySelect.value = 'off';
      stopAutoBtn.disabled = true;
    }
  }, 300);
}

function stopAutoIfNeeded() {
  if (!autoplayMode) return;
  if (autoplayRemaining === Infinity) {
    // keep going
    setTimeout(autoplayLoop, 300);
  } else if (autoplayRemaining > 0) {
    setTimeout(autoplayLoop, 300);
  } else {
    autoplayMode = false;
    autoplaySelect.value = 'off';
    stopAutoBtn.disabled = true;
  }
}

// disallow leaving running round accidentally
window.addEventListener('beforeunload', (e) => {
  if (running) {
    e.preventDefault();
    e.returnValue = '';
  }
});
</script>
</body>
</html>
